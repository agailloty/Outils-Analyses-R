---
title: "TD 5 ACM"
author: "Axel-Cleris Gailloty"
date: "2023-03-17"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Généralité de la méthode 

## Définir l’analyse des correspondances multiples 
C'est une méthode d'analyse factorielle qui s'appuie sur des données d'enquêtes. C'est comme l'ACP mais sur des données catégoriques. 


## Sur quel type de données utilise-t-on l’ACM ? 

L'ACM se fait sur des données qui prennent des modalités discrètes. Des catégories.

## Qu’est-ce qu’un tableau disjonctif complet ? 

Un tableau disjonctif est une représentation des modalités du jeu de données en des colonnes numériques. Nous faisons en sorte que chaque modalité devienne une colonne. 


## Comment mesure-t-on le degré d’association entre deux variables qualitatives ? 

On utilise le test d'indépendance du Khi-2 pour quantifier le degré d'association entre deux variables qualitatives. Avec d'autres transformations il est possible d'exprimer ce degré d'association dans un intervalle compris entre -1 et 1. 


# Lire, préparer et décrire le jeu de données 


## Lire le jeu de données mental_health_survey.xlsx avec R 

```{r}
library(readxl)
mental_health_survey <- read_excel("mental_health_survey.xlsx")
```


## Combien d’observation il y a-t-il dans le jeu de données ? Combien de variables? 

```{r}
str(mental_health_survey)
```

Le jeu de données contient 334 observations pour 31 variables. 

## Afficher les noms des colonnes du jeu de données 

```{r}
colnames(mental_health_survey)
```

## Renommer les colonnes 

• I am currently employed at least part-time : EMPLOYED 
• I identify as having a mental illness : MENTAL_ILLNESS 
• Education : EDUCATION 
• I have my own computer separate from a smart phone : OWN_COMPUTER 
• I have been hospitalized before for my mental illness : HOSPITALIZED 
• How many days were you hospitalized for your mental illness : DAYS_HOSPITALIZED 
• I am legally disabled : DISABLED 
• I have my regular access to the internet : HAS_INTERNET 
• I live with my parents : LIVE_WITH_PARENTS 
• I have a gap in my resume : GAP_RESUME 
• Total length of any gaps in my resume in months. : GAP_LENGTH 
• Annual income (including any social welfare programs) in USD : ANNUAL_INCOME 
• I am unemployed : UNEMPLOYED 
• I read outside of work and school : READ_OUTSIDE 
• Annual income from social welfare programs : ANNUAL_SOCIAL_WELFARE_INCOME 
• I receive food stamps : RECEIVE_FOOD_STAMPS 
• I am on section 8 housing : SECTION_8_HOUSING 
• How many times were you hospitalized for your mental illness : TIMES_HOSPITALIZED 
• Lack of concentration : LACK_CONCENTRATION 
• Anxiety : ANXIETY 
• Depression : DEPRESSION 
• Obsessive thinking : OBSESSIVE_THINKING 
• Mood swings : MOOD_SWINGS 
• Panic attacks : PANIC_ATTACKS 
• Compulsive behavior : COMPULSIVE_BEHAVIOR 
• Tiredness: TIREDNESS 
• Age : AGE 
• Gender : GENDER 
• Household Income : HOUSEHOLD_INCOME 
• Region : REGION 
• Device Type : DEVICE_TYPE 

```{r}
library(dplyr)

mental_health <- rename(mental_health_survey, 
                        "EMPLOYED" = "I am currently employed at least part-time",
                        "MENTAL_ILLNESS" = "I identify as having a mental illness",
                        "EDUCATION" = "Education",
                        "OWN_COMPUTER" = "I have my own computer separate from a smart phone",
                        "HOSPITALIZED" = "I have been hospitalized before for my mental illness",
                        "DAYS_HOSPITALIZED" = "How many days were you hospitalized for your mental illness",
                        "DISABLED" = "I am legally disabled",
                        "HAS_INTERNET" = "I have my regular access to the internet",
                        "LIVE_WITH_PARENTS" = "I live with my parents",
                        "GAP_RESUME" = "I have a gap in my resume",
                        "GAP_LENGTH" = "Total length of any gaps in my resume in months.",
                        "ANNUAL_INCOME" = "Annual income (including any social welfare programs) in USD",
                        "UNEMPLOYED" = "I am unemployed",
                        "READ_OUTSIDE" = "I read outside of work and school",
                        "ANNUAL_SOCIAL_WELFARE_INCOME" = "Annual income from social welfare programs",
                        "RECEIVE_FOOD_STAMPS" = "I receive food stamps",
                        "SECTION_8_HOUSING" = "I am on section 8 housing",
                        "TIMES_HOSPITALIZED" = "How many times were you hospitalized for your mental illness",
                        "LACK_CONCENTRATION" = "Lack of concentration",
                        "ANXIETY" = "Anxiety",
                        "DEPRESSION" = "Depression",
                        "OBSESSIVE_THINKING" = "Obsessive thinking",
                        "MOOD_SWINGS" = "Mood swings",
                        "PANIC_ATTACKS" = "Panic attacks",
                        "COMPULSIVE_BEHAVIOR" = "Compulsive behavior",
                        "TIREDNESS" = "Tiredness",
                        
                        "AGE" = "Age",
                        "GENDER" = "Gender",
                        "HOUSEHOLD_INCOME" = "Household Income",
                        "REGION" = "Region",
                        "DEVICE_TYPE" = "Device Type")

```


## Convertir toutes les colonnes non-numériques en facteur 

```{r}
num_cols <- c("DAYS_HOSPITALIZED", "GAP_LENGTH", "ANNUAL_INCOME", "ANNUAL_SOCIAL_WELFARE_INCOME", "TIMES_HOSPITALIZED")
# Prendre les colonnes non numériques
non_num_cols <- setdiff(colnames(mental_health), num_cols)
mental_health[non_num_cols] <- lapply(mental_health[non_num_cols], factor)
```

```{r}
str(mental_health)
```



## Décrire brièvement le jeu de données 

```{r}
summary(mental_health)
```

Dans le jeu de données 80 personne se déclarent avoir une maladie mentale. Les répondants sont majoritairement des personnes de 30-44 et 35-60 ans. 


## Réaliser une ACM avec FactoMineR 

```{r}
library(FactoMineR)
```

Nous allons utiliser la fonction MCA du package FactoMineR. 

function (X, ncp = 5, ind.sup = NULL, quanti.sup = NULL, quali.sup = NULL, 
    excl = NULL, graph = TRUE, level.ventil = 0, axes = c(1, 
        2), row.w = NULL, method = "Indicator", na.method = "NA", 
    tab.disj = NULL) 
    

La fonction MCA attend à ce qu'on lui fournisse en argument: 
- X : une matrice qui contient le jeu de données 
- ncp : le nombre de composante qu'on veut, par défaut FactoMiner suggère 5 mais on peut choisir le nombre de composantes qu'on veut.
- quanti.sup = les positions des variables qualitatives supplémentaires
- quali.sup : les positions des variables quantitatives supplémentaires

Créer des objets R qui représentent la position des variables quanti sup et des variables quali sup.

```{r}
quali_sup <- c("REGION", "DEVICE_TYPE")
idx_quali_sup <- match(quali_sup, colnames(mental_health))

idx_quanti_sup <- match(num_cols, colnames(mental_health))
```



```{r}
# Multiple correspondance analysis
premiere_acm <- MCA(mental_health, quanti.sup = idx_quanti_sup, quali.sup = idx_quali_sup, graph = FALSE)
```


## Combien de dimensions faut-il retenir dans l’ACM ? 

En ACM la règle de Kaiser-Guttman ne s'applique pas. Il n'y a pas de critrère pour sélectionne le nombre de composantes. 
Nous allons retenir le nombre de composantes qui explique suffisamment la variance du jeu de données.

```{r}
summary(premiere_acm)
```

 

## Quel % de la variance arrive-t-on à expliquer avec les dimensions retenues ? 
Nous allons retenir 4 composantes qui expliquent environ 34% de l'information.

## Combien de variables il y avait-il dans le jeu de données initial et combien de variables il y a-t-il dans l’ACM ? 

Dans le jeu de données initial nous avions 31 variables. En enlevant les variables quantitatives supplémentaires (5) et les variables qualitative supplémentaires (2), l'ACM a été réalisée sur 31 - 7 variables soit = 24 variables actives. 

Sauf qu'en formant le tableau disjonctif complet, la méthode a produit beaucoup de variables intermédiaires que les variables actives initiales. 

Le nombre de ces variables peut être retrouvé en explorant l'objet `premiere_acp`.


```{r}
print(paste("il y a ", length(premiere_acm$eig[,1]), "variables intermédiaires dans l'ACM"))
```



## Décrire les dimensions retenues dans l’analyse 

On va décrire les 4 dimensions (composantes, axes) qu'on a retenus en utilisant la fonction dimdesc.

Dans un premier temps, la corrélation entre les variables quantitatives supplémentaires et l'axe 1 a été calculée. 

Par exemple la variable GAP_LENGTH a une corrélation positive de 11% avec l'axe 1.

Ensuite il calcule le coefficient d'ajustement linaire (R2) entre les variables contenues dans le jeu de données initial et la dimension 1.
Par exemple la variable OBSESSIVE_THINKING est bien représenté sur l'axe 1. L'axe 1 est fortement lié aux variables PANIC_ATTACKS       MOOD_SWINGS         COMPULSIVE_BEHAVIOR  ... qui expriment bien des problèmes mentaux. Donc on peut conclure que l'axe mesure le caractère malade des personnes. 

```{r}
dimdesc(premiere_acm, axe = 1)
```


Réaliser une classification ascendante hiérarchique 

```{r}

```

Réaliser une CAH à partir des résultats de l’ACM, laisser FactoMineR décider du nombre optimal de cluster à former.